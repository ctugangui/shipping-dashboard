generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model PurchaseOrder {
  id          String     @id @default(cuid())
  orderNumber String     @unique
  status      String     @default("pending")
  metadata    String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  shipments   Shipment[]

  @@map("purchase_orders")
}

model Shipment {
  id              String          @id @default(cuid())
  trackingNumber  String          @unique
  carrier         String
  status          String          @default("pending")
  purchaseOrderId String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  purchaseOrder   PurchaseOrder   @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  trackingEvents  TrackingEvent[]

  @@map("shipments")
}

model TrackingEvent {
  id          String   @id @default(cuid())
  status      String
  description String?
  timestamp   DateTime
  shipmentId  String
  createdAt   DateTime @default(now())
  shipment    Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)

  @@map("tracking_events")
}

model InternalConfig {
  key       String    @id
  value     String
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("internal_configs")
}

model SystemToken {
  id        String   @id @default(uuid())
  provider  String   @unique // e.g., "UPS", "USPS"
  token     String
  expiresAt DateTime
  updatedAt DateTime @updatedAt

  @@map("system_tokens")
}

// Cache layer for tracking data from external APIs
model CachedShipment {
  id                String                @id @default(uuid())
  trackingNumber    String                @unique
  carrier           String                // e.g., "UPS", "FEDEX", "USPS"
  status            String                // e.g., "TRANSIT", "DELIVERED", "EXCEPTION"
  estimatedDelivery DateTime?
  currentLocation   String?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt // Acts as cache timestamp
  events            CachedShipmentEvent[]

  @@map("cached_shipments")
}

model CachedShipmentEvent {
  id          String          @id @default(uuid())
  shipmentId  String
  shipment    CachedShipment  @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  timestamp   DateTime
  location    String?
  description String
  status      String          // The normalized status code

  @@map("cached_shipment_events")
}
